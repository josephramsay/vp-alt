# Hive standalone metastore, keeps track of table metadata.
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: metastore2
  name: metastore2
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app: metastore2
  strategy: 
    rollingUpdate: 
      maxUnavailable: 20
  template:
    metadata:
      labels:
        app: metastore2
    spec:
      nodeSelector:
        kubernetes.io/arch: amd64
        alpha.eksctl.io/cluster-name: vp-metatrino
        alpha.eksctl.io/nodegroup-name: metastore-mng
      containers:
      - name: metastore2
        image: scienz/walden-metastore:latest
        env:
          - name: POSTGRES_HOST
            valueFrom:
              secretKeyRef:
                name: metatrino-secret
                key: rds-pg-host
          - name: POSTGRES_NAME
            valueFrom:
              secretKeyRef:
                name: metatrino-secret
                key: rds-pg-name
          - name: POSTGRES_PORT
            value: "{{ .Values.postgres.port }}"
          - name: POSTGRES_USER
            valueFrom:
              secretKeyRef:
                name: metatrino-secret
                key: rds-pg-user
          - name: POSTGRES_PASSWORD
            valueFrom:
              secretKeyRef:
                name: metatrino-secret
                key: rds-pg-pass
          - name: METASTORE_NAME
            value: {{ .Values.metastore.name }}
          - name: METASTORE_PORT
            value: "{{ .Values.metastore.port }}"
        imagePullPolicy: "Always"
        ports:
        - containerPort: {{ .Values.metastore.port }}
        resources: {}
        volumeMounts:
          - mountPath: /apache-hive-metastore-3.1.2-bin/metastore-site.xml.template
            name: config
            subPath: metastore-site.xml.template
            readOnly: false
      volumes:
        - name: config
          configMap:
            defaultMode: 420
            name: metastore2
      restartPolicy: Always
      serviceAccountName: ""
status: {}